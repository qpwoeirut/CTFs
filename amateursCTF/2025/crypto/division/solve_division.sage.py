

# This file was *autogenerated* from the file solve_division.sage
from sage.all_cmdline import *   # import sage library

_sage_const_75375527234510651665677207066229891926040929328980582924525303994966835168796055022727363375804269692143070561263128516881074866977604549208239672350292604269324775848328528401041649243536698878068388663854658455888665567421528139676553398379791728850136444114360571254958597748469715514303229969364378553163423222522897412606507907342566717324675248648278152290809106176295241303943659155279739413927229119348178739649701446536277787785586385384290648596225479179951687047854987093302449400449408907035601103612171991422127378147919500898428845497702002243505620992542869790261271932282435731195032724808409252081154632950628964417018040860488194082532635686263681213906375790385569586239071410623996119802591938958940165788806391189899599255362316672332888493379847547083365240770226903398674774357924053797951490900058983308593594684075033516959188148000904700191560112121648591490057629599361214369099947477414730697724448515856824615139071844639957575363257387078768257241797937595586141467195592425033618924139126557481 = Integer(75375527234510651665677207066229891926040929328980582924525303994966835168796055022727363375804269692143070561263128516881074866977604549208239672350292604269324775848328528401041649243536698878068388663854658455888665567421528139676553398379791728850136444114360571254958597748469715514303229969364378553163423222522897412606507907342566717324675248648278152290809106176295241303943659155279739413927229119348178739649701446536277787785586385384290648596225479179951687047854987093302449400449408907035601103612171991422127378147919500898428845497702002243505620992542869790261271932282435731195032724808409252081154632950628964417018040860488194082532635686263681213906375790385569586239071410623996119802591938958940165788806391189899599255362316672332888493379847547083365240770226903398674774357924053797951490900058983308593594684075033516959188148000904700191560112121648591490057629599361214369099947477414730697724448515856824615139071844639957575363257387078768257241797937595586141467195592425033618924139126557481); _sage_const_48648359606087607054764975061246586804946899771075465950463841480503792391242075718361379574064958310831886132797205905782225730921050328582127691139051377153885590959058584931544239373521818766047205266802911821810151109225243130179140623399478388305644784028218706385078397300157808478028917780169261334807047724247279925670091509482240375019889452543079342438321747327926834796379012339921188615926117511143813280492641218017371403897472661550045565397359426254471576804581357221127582353441561380497515665661934473669613838790969595463036823630557187360129867186459025552953339813671569683189170774295708055929734217591905795428441403136096735625270568765197391423757594103320945558276124412602379303298694436105059220213537852584622876964933389323070365214287371704961312345353833390325002117393017327937680001690416415146226901969211615033627210161600009415469801626322733646436539056402194785639655852044899338363041427982892348396424818762289291934998870311926616547712216114710383692009811315188831592384925859038824 = Integer(48648359606087607054764975061246586804946899771075465950463841480503792391242075718361379574064958310831886132797205905782225730921050328582127691139051377153885590959058584931544239373521818766047205266802911821810151109225243130179140623399478388305644784028218706385078397300157808478028917780169261334807047724247279925670091509482240375019889452543079342438321747327926834796379012339921188615926117511143813280492641218017371403897472661550045565397359426254471576804581357221127582353441561380497515665661934473669613838790969595463036823630557187360129867186459025552953339813671569683189170774295708055929734217591905795428441403136096735625270568765197391423757594103320945558276124412602379303298694436105059220213537852584622876964933389323070365214287371704961312345353833390325002117393017327937680001690416415146226901969211615033627210161600009415469801626322733646436539056402194785639655852044899338363041427982892348396424818762289291934998870311926616547712216114710383692009811315188831592384925859038824); _sage_const_86177866064517609033880568807115953555242816860796465315994122793500658219204691266285400596992843986822859067988140541321102737268469256003488633194805732902328449668973675656034407479445206199285327332956250166678724833829086476894512753542599582930303813548509716626122990897384869145771777456521841989016732565902948058499497558560940675936638149144787557866682549895410172503475134761737103764159012832476099457080767621349093023525464199464437775892158425340808608831357847290625769994444619608418683397291585743320119410163556022541745013298562365924431890839096568358382609153300688137255847854540583022798338370905413030872305343628451395156651510799422269846199097346654778450970192181652155045761310415676411676415321314004703082183268372839586588063507099961869739615845147256459914569897668249853629651515566126984158856990492614415609777375564680454921886476795802100545467623117528820164062239760078312599781978838070617837964620704025708935814492400262083101517057997114593888320133983970592497555237407111597 = Integer(86177866064517609033880568807115953555242816860796465315994122793500658219204691266285400596992843986822859067988140541321102737268469256003488633194805732902328449668973675656034407479445206199285327332956250166678724833829086476894512753542599582930303813548509716626122990897384869145771777456521841989016732565902948058499497558560940675936638149144787557866682549895410172503475134761737103764159012832476099457080767621349093023525464199464437775892158425340808608831357847290625769994444619608418683397291585743320119410163556022541745013298562365924431890839096568358382609153300688137255847854540583022798338370905413030872305343628451395156651510799422269846199097346654778450970192181652155045761310415676411676415321314004703082183268372839586588063507099961869739615845147256459914569897668249853629651515566126984158856990492614415609777375564680454921886476795802100545467623117528820164062239760078312599781978838070617837964620704025708935814492400262083101517057997114593888320133983970592497555237407111597); _sage_const_3 = Integer(3); _sage_const_2 = Integer(2); _sage_const_0 = Integer(0); _sage_const_1 = Integer(1); _sage_const_7 = Integer(7); _sage_const_8 = Integer(8)# Generated by Gemini Pro

# We are given these values from the challenge output
# ---
# NOTE: You must paste in the c, r, p values from your *own*
# challenge instance here. The values below are from the
# *example* in the file.
# ---
c = _sage_const_75375527234510651665677207066229891926040929328980582924525303994966835168796055022727363375804269692143070561263128516881074866977604549208239672350292604269324775848328528401041649243536698878068388663854658455888665567421528139676553398379791728850136444114360571254958597748469715514303229969364378553163423222522897412606507907342566717324675248648278152290809106176295241303943659155279739413927229119348178739649701446536277787785586385384290648596225479179951687047854987093302449400449408907035601103612171991422127378147919500898428845497702002243505620992542869790261271932282435731195032724808409252081154632950628964417018040860488194082532635686263681213906375790385569586239071410623996119802591938958940165788806391189899599255362316672332888493379847547083365240770226903398674774357924053797951490900058983308593594684075033516959188148000904700191560112121648591490057629599361214369099947477414730697724448515856824615139071844639957575363257387078768257241797937595586141467195592425033618924139126557481 
r = _sage_const_48648359606087607054764975061246586804946899771075465950463841480503792391242075718361379574064958310831886132797205905782225730921050328582127691139051377153885590959058584931544239373521818766047205266802911821810151109225243130179140623399478388305644784028218706385078397300157808478028917780169261334807047724247279925670091509482240375019889452543079342438321747327926834796379012339921188615926117511143813280492641218017371403897472661550045565397359426254471576804581357221127582353441561380497515665661934473669613838790969595463036823630557187360129867186459025552953339813671569683189170774295708055929734217591905795428441403136096735625270568765197391423757594103320945558276124412602379303298694436105059220213537852584622876964933389323070365214287371704961312345353833390325002117393017327937680001690416415146226901969211615033627210161600009415469801626322733646436539056402194785639655852044899338363041427982892348396424818762289291934998870311926616547712216114710383692009811315188831592384925859038824 
p = _sage_const_86177866064517609033880568807115953555242816860796465315994122793500658219204691266285400596992843986822859067988140541321102737268469256003488633194805732902328449668973675656034407479445206199285327332956250166678724833829086476894512753542599582930303813548509716626122990897384869145771777456521841989016732565902948058499497558560940675936638149144787557866682549895410172503475134761737103764159012832476099457080767621349093023525464199464437775892158425340808608831357847290625769994444619608418683397291585743320119410163556022541745013298562365924431890839096568358382609153300688137255847854540583022798338370905413030872305343628451395156651510799422269846199097346654778450970192181652155045761310415676411676415321314004703082183268372839586588063507099961869739615845147256459914569897668249853629651515566126984158856990492614415609777375564680454921886476795802100545467623117528820164062239760078312599781978838070617837964620704025708935814492400262083101517057997114593888320133983970592497555237407111597 

# 1. Estimate x
# p is a (3*x)-bit prime.
L = p.bit_length()
x = L // _sage_const_3 
T = _sage_const_2  ** (_sage_const_2  * x)
S = _sage_const_2  ** x  # Our scaling factor, bound on the unknowns

print(f"[*] p bit length (L): {L}")
print(f"[*] Estimated x (L/3): {x}")
print(f"[*] Calculated T = 2^(2x)")
print(f"[*] Using scaling factor S = 2^x")

# 2. Build the *scaled* lattice basis matrix B
# We scale column 0 to heavily penalize non-zero entries there.
# We also scale column 3, which helps balance the target vector.
B = Matrix(ZZ, [[S * p, _sage_const_0 , _sage_const_0 , _sage_const_0 ],
                [S * r, _sage_const_1 , _sage_const_0 , _sage_const_0 ],
                [S * T, _sage_const_0 , _sage_const_1 , _sage_const_0 ],
                [S * c, _sage_const_0 , _sage_const_0 , S]])  # <--- Scale col 0 AND col 3

print("\n[*] Running LLL algorithm...")
# 3. Run LLL
B_lll = B.LLL()

print("[*] LLL complete. Inspecting the first (shortest) vector:")
# 4. Inspect the shortest vector
# The shortest vector v0 should be [0, flag, s', -S] or [0, -flag, -s', S]
v0 = B_lll[_sage_const_0 ]
print(f"    v0 = {v0}")

# 5. Extract the flag
# Check that the vector has the new expected form
if v0[_sage_const_0 ] == _sage_const_0  and abs(v0[_sage_const_3 ]) == S:
    # The flag is the absolute value of the second component
    flag_int = abs(v0[_sage_const_1 ])
    print(f"\n[+] Found potential flag (int): {flag_int}")

    # 6. Convert the flag integer back to bytes
    try:
        flag_bytes = flag_int.to_bytes((flag_int.bit_length() + _sage_const_7 ) // _sage_const_8 , 'big')
        print(f"\n[+] Flag (bytes): {flag_bytes.decode()}")

        # 7. Verification
        s_prime = abs(v0[_sage_const_2 ])
        s_calc = s_prime * T
        if (r * flag_int + s_calc) % p == c:
            print("[+] Verification SUCCESSFUL!")
        else:
            print("[-] Verification FAILED (calc does not match c).")

    except Exception as e:
        print(f"\n[-] Error decoding flag bytes: {e}")

else:
    print("\n[-] Attack failed. The shortest vector does not have the expected form.")
    print(f"[-] Check: v0[0] == 0 (is {v0[_sage_const_0 ] == _sage_const_0 })")
    print(f"[-] Check: abs(v0[3]) == S (is {abs(v0[_sage_const_3 ]) == S})")


import math
import random
from collections import Counter

import numpy as np
from matplotlib import pyplot as plt


phi = (1 + 5 ** 0.5) / 2


def random_phinary() -> str:
    first = bin(random.randint(0, 1 << 11 - 1))[2:].rjust(11, '0')
    second = bin(random.randint(0, 1 << 3 - 1))[2:].rjust(3, '0')
    return f"{first}.{second}"


def from_phinary(num: str) -> float:
    val = 0
    decimal_places = 0
    for digit in num:
        if digit == '.':
            decimal_places = 1
            continue
        if decimal_places == 0:
            val += int(digit, 2)
            val *= phi
        else:
            val += int(digit, 2) * pow(phi, -decimal_places)
            decimal_places += 1
    return val


def main():
    s = "01010010100.01001001000100.01001010000100.00101010010101.01000100100100.00100100000100.01000100000101.01000100001010.00000100000001.00001001010000.00000100010010.01000100010010.01001001001000.10001001000101.01001001010000.00001001000100.01001001010001.00000100000010.01000100010000.00001001001000.10000100010100.01000000010100.01001010000010.00101001010000.00001010101000.10000100100100.00101001000100.01000100010100.01001001010001.00000100010010.01000100010000.00001001000101.01000100010010.01000100010001.00000100001000.10001001000101.01001001001010.00000100010100.01000100000100.01000100010001.00000100000001.00000100001010.00000100010001.00001001000100.01000100000001.00000100001010.00000100001000.10000100000001.00000100010010.01001001001010.00000100000100.01000100010001.00000100001000.10001001010000.00001001010000.00000100000101.01001001000100.01000100010010.01000100010010.01001001000100.01000100010010.01000100000101.01001001000100.01001001001010.00000100010100.01000100010001.00000100000100.01000100000100.01000100000010.01000100010001.00001001000101.01000100010010.01000100000010.01001001010001.00001001001010.00001001001000.10000100000100.01001001000101.01001001000101.01000100010010.01001001010000.00000100010010.01001001001000.10001001000100.01000100010010.01000100010001.00000100000101.01000100010000.00001001001010.00001001000100.01000000010100.01001001010101.01001010100010.00100100100100.00100100010100.01000100000001.00000100010010.01000100001000.10000100001010.00000100010010.01001001010000.00000100001000.10000100010010.01001001010001.00001001001000.10000100010010.01001001001010.00001001000101.01000100000010.01001001001000.10000100001010.00001001000100.01000100001000.10000100010000.00001001010001.00000100000010.01000100010010.01001001010001.00000100000001.00001001010001.00001001010000.00001001000101.01000100000010.01000100000010.01000100010100.01001001010001.00000000010100.010"

    original = [s[i:i + 15] for i in range(0, len(s), 15)]
    drops = [t[0] for t in Counter(original).most_common()[-9:]]
    t = s
    for drop in drops:
        t = t.replace(drop, '')

    cleaned = [t[i:i + 15] for i in range(0, len(t), 15)]
    # cleaned = [x[::-1] for x in cleaned]
    out = np.array([from_phinary(x) for x in cleaned])

    plt.figure(figsize=(10, 4))
    plt.plot(out, "bo")
    plt.show()
    plt.savefig("cleaned")


    # stuff = [str(int(x < 125)) for x in cleaned]
    # print(''.join(stuff))
    #
    # z = ''.join(stuff)
    # z = z[::-1]
    # print([int(z[i:i+8], 2) for i in range(0, len(z), 8)])

    # random_test()


def random_test():
    randoms = [from_phinary(random_phinary()) for _ in range(127)]
    plt.figure(figsize=(10, 4))
    plt.plot(randoms, "bo")
    # plt.show()
    plt.savefig("randoms")


if __name__ == '__main__':
    main()
